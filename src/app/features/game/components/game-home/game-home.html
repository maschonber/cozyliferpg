<div class="game-home">
  <div class="header">
    <h1>CozyLife RPG</h1>
    <p class="subtitle">Discover interesting people in your neighborhood</p>
  </div>

  <!-- Current Location Section (clickable to travel) -->
  @if (currentLocation(); as loc) {
    <app-location-marker
      [locationId]="loc.id"
      [locationName]="loc.name"
      [district]="loc.district"
      [description]="loc.description"
      [clickable]="true"
      [isCurrent]="true"
      (markerClick)="onOpenLocationSelector()">
    </app-location-marker>
  }

  <!-- Solo Activities Section (Phase 2) -->
  <div class="activities-section">
    <h2>What Would You Like To Do?</h2>

    @if (interactionError()) {
      <div class="error-message">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ interactionError() }}</span>
      </div>
    }

    <div class="activities-grid">
      @for (activity of soloActivities(); track activity.id) {
        <app-activity-button
          [activity]="activity"
          [availability]="getActivityAvailability(activity.id)"
          [disabled]="interacting()"
          (activityClick)="onPerformSoloActivity($event)">
        </app-activity-button>
      }
    </div>

    @if (interacting()) {
      <div class="interacting-indicator">
        <mat-spinner diameter="24"></mat-spinner>
        <span>Performing activity...</span>
      </div>
    }

    <!-- Action Buttons (Phase 3: Added Location Selector) -->
    <div class="action-section">
      <button
        mat-raised-button
        color="accent"
        class="location-button"
        (click)="onOpenLocationSelector()"
        [disabled]="interacting()">
        <mat-icon>map</mat-icon>
        Travel
      </button>

      <button
        mat-raised-button
        color="primary"
        class="sleep-button"
        (click)="onSleep()"
        [disabled]="interacting()">
        <mat-icon>bedtime</mat-icon>
        Sleep
      </button>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- Your Neighbors Section -->
  <div class="neighbors-section">
    <h2>Your Neighbors</h2>

    <!-- Loading State -->
    @if (relationshipsLoading()) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading neighbors...</p>
      </div>
    }

    <!-- Error State -->
    @if (relationshipsError()) {
      <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ relationshipsError() }}</p>
      </div>
    }

    <!-- Empty State -->
    @if (!relationshipsLoading() && !relationshipsError() && npcsWithRelationships().length === 0) {
      <div class="empty-state">
        <mat-icon>group</mat-icon>
        <p>You haven't met anyone yet.</p>
        <p class="hint">Click "Meet Someone New" to start discovering neighbors!</p>
      </div>
    }

    <!-- Neighbors List -->
    @if (npcsWithRelationships().length > 0) {
      <div class="neighbors-list">
        @for (item of npcsWithRelationships(); track item.npc.id) {
          <mat-card
            class="neighbor-card"
            [class.positive]="getStateColor(item.relationship) === 'positive'"
            [class.negative]="getStateColor(item.relationship) === 'negative'"
            [class.neutral]="getStateColor(item.relationship) === 'neutral'"
            (click)="onViewNeighbor(item.npc.id)">
            <div class="card-layout">
              <div class="card-content">
                <mat-card-header>
                  <mat-card-title>
                    {{ item.npc.name }}
                    <span class="gender-badge" [class.gender-female]="item.npc.gender === 'female'"
                          [class.gender-male]="item.npc.gender === 'male'"
                          [class.gender-other]="item.npc.gender === 'other'">
                      @if (item.npc.gender === 'female') {
                        <mat-icon>female</mat-icon>
                      } @else if (item.npc.gender === 'male') {
                        <mat-icon>male</mat-icon>
                      } @else {
                        <mat-icon>transgender</mat-icon>
                      }
                    </span>
                  </mat-card-title>
                  <mat-card-subtitle>
                    <div class="subtitle-content">
                      <span>{{ item.npc.archetype }}</span>
                      <span class="location-badge">
                        <mat-icon class="tiny-icon">place</mat-icon>
                        {{ getLocationDisplayName(item.npc.currentLocation) }}
                      </span>
                    </div>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <div class="relationship-status">
                    <div class="status-badge">
                      {{ getStateDisplayName(item.relationship.currentState) }}
                    </div>
                    <div class="relationship-values">
                      <span class="value-item">
                        <mat-icon class="small-icon">favorite</mat-icon>
                        Friendship: {{ item.relationship.friendship }}
                      </span>
                      <span class="value-item">
                        <mat-icon class="small-icon">whatshot</mat-icon>
                        Romance: {{ item.relationship.romance }}
                      </span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button color="primary">
                    <mat-icon>arrow_forward</mat-icon>
                    View Details
                  </button>
                </mat-card-actions>
              </div>

              <div class="avatar-container" [class.gender-female]="item.npc.gender === 'female'"
                   [class.gender-male]="item.npc.gender === 'male'"
                   [class.gender-other]="item.npc.gender === 'other'">
                <mat-icon>person</mat-icon>
              </div>
            </div>
          </mat-card>
        }
      </div>
    }
  </div>
</div>
