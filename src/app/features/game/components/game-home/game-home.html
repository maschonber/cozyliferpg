<div class="game-home">
  <div class="header">
    <h1>CozyLife RPG</h1>
    <!-- <p class="subtitle">Discover interesting people in your neighborhood</p> -->
  </div>

  <!-- Current Location Section (clickable to travel) -->
  @if (currentLocation(); as loc) {
    <app-location-marker
      [locationId]="loc.id"
      [locationName]="loc.name"
      [district]="loc.district"
      [description]="loc.description"
      [clickable]="true"
      [isCurrent]="true"
      (markerClick)="onOpenLocationSelector()">
    </app-location-marker>
  }

  <!-- Character Stats Section (Phase 2.5) -->
  <mat-expansion-panel class="stats-expansion-panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon>assessment</mat-icon>
        Character Stats
      </mat-panel-title>
      <mat-panel-description>
        View your abilities
      </mat-panel-description>
    </mat-expansion-panel-header>
    <app-stats-panel></app-stats-panel>
  </mat-expansion-panel>

  <!-- Solo Activities Section (Phase 2) -->
  <div class="activities-section">
    <h2>What Would You Like To Do?</h2>

    @if (interactionError()) {
      <div class="error-message">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ interactionError() }}</span>
      </div>
    }

    <div class="activities-grid">
      @for (activity of soloActivities(); track activity.id) {
        <app-activity-button
          [activity]="activity"
          [availability]="getActivityAvailability(activity.id)"
          [disabled]="interacting()"
          (activityClick)="onPerformSoloActivity($event)">
        </app-activity-button>
      }
    </div>

    @if (interacting()) {
      <div class="interacting-indicator">
        <mat-spinner diameter="24"></mat-spinner>
        <span>Performing activity...</span>
      </div>
    }

    <!-- Action Buttons (Phase 3: Added Location Selector) -->
    <div class="action-section">
      <button
        mat-raised-button
        color="accent"
        class="location-button"
        (click)="onOpenLocationSelector()"
        [disabled]="interacting()">
        <mat-icon>map</mat-icon>
        Travel
      </button>

      <button
        mat-raised-button
        color="primary"
        class="sleep-button"
        (click)="onSleep()"
        [disabled]="interacting()">
        <mat-icon>bedtime</mat-icon>
        Sleep
      </button>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- Your Neighbors Section -->
  <div class="neighbors-section">
    <h2>Your Neighbors</h2>

    <!-- Loading State -->
    @if (npcsLoading()) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading neighbors...</p>
      </div>
    }

    <!-- Error State -->
    @if (npcsError()) {
      <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ npcsError() }}</p>
      </div>
    }

    <!-- Empty State -->
    @if (!npcsLoading() && !npcsError() && npcsAtCurrentLocation().length === 0) {
      <div class="empty-state">
        <mat-icon>group</mat-icon>
        <p>No neighbors at this location.</p>
        <p class="hint">Try traveling to meet your friends, or meet someone new here!</p>
      </div>
    }

    <!-- Neighbors List -->
    @if (npcsAtCurrentLocation().length > 0) {
      <div class="neighbors-list">
        @for (npc of npcsAtCurrentLocation(); track npc.id) {
          <mat-card
            class="neighbor-card"
            [class.positive]="getStateColor(npc) === 'positive'"
            [class.negative]="getStateColor(npc) === 'negative'"
            [class.neutral]="getStateColor(npc) === 'neutral'"
            (click)="onViewNeighbor(npc.id)">
            <div class="card-layout">
              <div class="card-content">
                <mat-card-header>
                  <mat-card-title>
                    {{ npc.name }}
                  </mat-card-title>
                </mat-card-header>

                <mat-card-content>
                  <div class="relationship-status">
                    <div class="status-badge">
                      {{ getStateDisplayName(npc.currentState) }}
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button color="primary">
                    <mat-icon>arrow_forward</mat-icon>
                    View Details
                  </button>
                </mat-card-actions>
              </div>

              <div class="avatar-container" [class.gender-female]="npc.gender === 'female'"
                   [class.gender-male]="npc.gender === 'male'"
                   [class.gender-other]="npc.gender === 'other'">
                <mat-icon>person</mat-icon>
              </div>
            </div>
          </mat-card>
        }
      </div>
    }
  </div>
</div>
