<div class="location-selector">
  <!-- Back Button and Go Home -->
  <div class="header-actions">
    <button mat-button (click)="onBack()" [disabled]="traveling()">
      <mat-icon>arrow_back</mat-icon>
      Back to Home
    </button>
    <button
      mat-raised-button
      color="accent"
      (click)="onGoHome()"
      [disabled]="isCurrentLocation('home') || traveling()">
      <mat-icon>home</mat-icon>
      Go Home
    </button>
  </div>

  <!-- Page Title -->
  <div class="page-header">
    <h2>Choose Your Destination</h2>
    @if (player(); as p) {
      <p class="current-location-info">
        <mat-icon class="small-icon">place</mat-icon>
        Currently at: <strong>{{ getLocationDisplayName(p.currentLocation) }}</strong>
      </p>
    }
  </div>

  <!-- Loading State -->
  @if (locationsLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading locations...</p>
    </div>
  }

  <!-- Locations by District -->
  @if (!locationsLoading()) {
    <div class="districts-container">
      @for (district of districts; track district) {
        <div class="district-section">
          <h3 class="district-title">
            <mat-icon>{{ getDistrictIcon(district) }}</mat-icon>
            {{ getDistrictName(district) }}
          </h3>

          <div class="locations-grid">
            @for (location of locationsByDistrict()[district]; track location.id) {
              <button
                mat-raised-button
                class="location-card"
                [class.current]="isCurrentLocation(location.id)"
                [disabled]="isCurrentLocation(location.id) || traveling()"
                (click)="onTravelTo(location.id)">

                <!-- Location Icon -->
                <div class="location-icon">
                  <mat-icon>{{ getLocationIcon(location.id) }}</mat-icon>
                </div>

                <!-- Location Info -->
                <div class="location-info">
                  <span class="location-name">{{ location.name }}</span>

                  <!-- NPC Count Badge -->
                  @if (location.npcCount !== undefined && location.npcCount > 0) {
                    <span class="npc-badge">
                      <mat-icon class="tiny-icon">person</mat-icon>
                      {{ location.npcCount }}
                    </span>
                  }

                  <!-- Current Location Indicator -->
                  @if (isCurrentLocation(location.id)) {
                    <span class="current-badge">
                      <mat-icon class="tiny-icon">check_circle</mat-icon>
                      Here
                    </span>
                  }

                  <!-- Operating Hours -->
                  @if (location.openTime && location.closeTime) {
                    <span class="location-hours">
                      {{ location.openTime }}-{{ location.closeTime }}
                    </span>
                  }
                </div>
              </button>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Traveling Indicator -->
  @if (traveling()) {
    <div class="traveling-overlay">
      <mat-spinner diameter="60"></mat-spinner>
      <p>Traveling...</p>
    </div>
  }
</div>
