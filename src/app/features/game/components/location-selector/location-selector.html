<div class="location-selector">
  <!-- Back Button and Go Home -->
  <div class="header-actions">
    <button mat-button (click)="onBack()" [disabled]="traveling()">
      <mat-icon>arrow_back</mat-icon>
      Back to Home
    </button>
    <button
      mat-raised-button
      color="accent"
      (click)="onGoHome()"
      [disabled]="isCurrentLocation('home') || traveling()">
      <mat-icon>home</mat-icon>
      Go Home
    </button>
  </div>

  <!-- Page Title -->
  <div class="page-header">
    <h1>
      <mat-icon>map</mat-icon>
      Choose Your Destination
    </h1>
    @if (player(); as p) {
      <p class="current-location-info">
        <mat-icon class="small-icon">place</mat-icon>
        Currently at: <strong>{{ getLocationDisplayName(p.currentLocation) }}</strong>
      </p>
    }
  </div>

  <!-- Loading State -->
  @if (locationsLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading locations...</p>
    </div>
  }

  <!-- Locations by District -->
  @if (!locationsLoading()) {
    <div class="districts-container">
      @for (district of districts; track district) {
        <mat-card class="district-card">
          <mat-card-header>
            <mat-card-title class="district-title">
              <mat-icon>{{ getDistrictIcon(district) }}</mat-icon>
              {{ getDistrictName(district) }}
            </mat-card-title>
            <mat-card-subtitle>{{ getDistrictDescription(district) }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="locations-grid">
              @for (location of locationsByDistrict()[district]; track location.id) {
                <button
                  mat-raised-button
                  class="location-card"
                  [class.current]="isCurrentLocation(location.id)"
                  [disabled]="isCurrentLocation(location.id) || traveling()"
                  (click)="onTravelTo(location.id)">

                  <!-- Location Icon -->
                  <div class="location-icon">
                    <mat-icon>{{ getLocationIcon(location.id) }}</mat-icon>
                  </div>

                  <!-- Location Info -->
                  <div class="location-info">
                    <div class="location-name">{{ location.name }}</div>

                    <!-- NPC Count Badge -->
                    @if (location.npcCount !== undefined && location.npcCount > 0) {
                      <div class="npc-badge">
                        <mat-icon class="small-icon">person</mat-icon>
                        <span>{{ location.npcCount }} {{ location.npcCount === 1 ? 'neighbor' : 'neighbors' }}</span>
                      </div>
                    }

                    <!-- Current Location Indicator -->
                    @if (isCurrentLocation(location.id)) {
                      <div class="current-badge">
                        <mat-icon class="small-icon">check_circle</mat-icon>
                        <span>You are here</span>
                      </div>
                    }
                  </div>

                  <!-- Operating Hours (if applicable) -->
                  @if (location.openTime && location.closeTime) {
                    <div class="location-hours">
                      <mat-icon class="tiny-icon">schedule</mat-icon>
                      <span>{{ location.openTime }} - {{ location.closeTime }}</span>
                    </div>
                  } @else {
                    <div class="location-hours always-open">
                      <mat-icon class="tiny-icon">schedule</mat-icon>
                      <span>Open 24/7</span>
                    </div>
                  }
                </button>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>
  }

  <!-- Traveling Indicator -->
  @if (traveling()) {
    <div class="traveling-overlay">
      <mat-spinner diameter="60"></mat-spinner>
      <p>Traveling...</p>
    </div>
  }
</div>
